<!doctype html>

<html class="no-js" lang="fr">

<head>
		<meta charset="UTF-8">
		<title>test Chessboard</title>
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<link rel="stylesheet" href="/static/css/bootstrap.css" media="all">
		<link rel="stylesheet" href="/static/css/chessboard-0.3.0.min.css" media="all">
		<link rel="stylesheet" href="/static/css/styles.css" media="all">
</head>
<body>
	<div class="row-fluid">
		<div id="board"></div>
		<div class="container">
			<div class="mytable">
				<table id="moves" class="table table-striped">
				</table>
			</div>
			<div class="buttons">
				<button type="button" id="begin"><i class="icon-fast-backward"></i></button>
				<button type="button" id="backward"><i class="icon-step-backward"></i></button>
				<button type="button" id="forward"><i class="icon-step-forward"></i></button>
				<button type="button" id="end"><i class="icon-fast-forward"></i></button>
			</div>
		</div>
		<div id="area"></div>
	</div>


<script type="text/javascript" src="/static/js/jquery.min.js" ></script>
<script type="text/javascript" src="/static/js/chessboard-0.3.0.min.js" ></script>
<script type="text/javascript" src="/static/js/json3.min.js" ></script>
<script type="text/javascript" src="/static/js/bootstrap.min.js" ></script>
<script type="text/javascript" src="/static/js/highcharts.js"></script>
<!-- <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/2.4.1/lodash.min.js"></script> -->
<script>
var board = ChessBoard('board', {
  pieceTheme	: '/static/img/chesspieces/{piece}.png'
  , position	: 'start'
  , draggable	: false
  , showErrors 	: 'console'
});
var i = -1;
var fens = [<% for(var i in moves) { %> '<%= moves[i].fen %>' ,<% } %>];

$(document).ready(function() {
	$("#moves").append(<% for(var i in moves) { %> <% if(i%2 == 0) { %>'<tr><td><%= i/2 %></td><td id="<%= i %>"><%= moves[i].position %> <%= moves[i].depths[19].scoreCp %></td>' +  <% } else { %>'<td id="<%= i %>"><%= moves[i].position %> <%= moves[i].depths[19].scoreCp %></td></tr>' + <% }} %> "");
	$('#area').highcharts({
	   	chart: {
	       type: 'area',
		   height: 400,
           width: 1000,
		},
		title: {
		   text: 'Moves score of players'
		},
		xAxis: {
			categories: [<% for(var i in moves) { %> '<%= moves[i].position %>' ,<% } %>],
			plotBands: [{
				color: '#D4C1B1', // Color value
				from: -0.5, // Start of the plot band
				to: <%= game.opening.length %> - 0.5, // End of the plot band
				label: {
				   text: '<%= game.opening.name %><br/><%= game.opening.variation%>' // Content of the label.
				}
			}],
		},
		/*tooltip: {
		    formatter: function() {
		        return 'The value for <b>' + this.x + '</b> is <b>' + this.y + '</b>, in series '+ this.series.name;
		    }
		},*/
		yAxis: {
			// min: -200,
			// max: 200,
			title: {
				text: 'Score'
			}
		},
		series: [{
			name: 'Scores',
			data: [<% for(var i in moves) { %> <%= moves[i].depths[19].scoreCp %> ,<% } %>],
			color: '#A6B2B0',
			negativeColor: '#000000',
			point: {
	            events: {
	                click: function (e) {
						i = e.point.index;
						board.position(fens[i]);
	                }
	            }
	        },
			allowPointSelect: true,
			marker: {
				radius: 1,
				states: {
					select: {
					   radius: 3,
					   fillColor: 'yellow'
					}
				}
			}
	   }]
	});
	var chart = Highcharts.charts[0];
	$('#begin').on('click', function(){
		board.start();
		if (i > -1){
			chart.series[0].points[i].select(false);
			$("td#" + i).css("background-color","");
			$(".mytable").scrollTop($('td#0').offset().top);
			i = -1;
		}
		// $(".mytable").scrollTop($('td#' + i).offset().top);
	});

	$('#forward').on('click', function(){
		if (i < fens.length - 1){
			$("td#" + i).css("background-color","");
			i++;
			$("td#" + i).css("background-color","yellow");
			board.position(fens[i]);
			chart.series[0].points[i].select();
			$(".mytable").scrollTop($('td#0').offset().top);
			$(".mytable").scrollTop($('td#' + i).offset().top - 100);
		}
	});

	$('#backward').on('click', function(){
		if (i > 0){
			$("td#" + i).css("background-color","");
			i--;
			$("td#" + i).css("background-color","yellow");
			board.position(fens[i]);
			chart.series[0].points[i].select();
			$(".mytable").scrollTop($('td#0').offset().top);
			$(".mytable").scrollTop($('td#' + i).offset().top - 100);
		}
		else{
			board.start();
			chart.series[0].points[i].select(false);
			$("td#" + i).css("background-color","");
			i = -1;
			// $(".mytable").scrollTop($('td#0').offset().top);
		}
	});

	$('#end').on('click', function(){
		$("td#" + i).css("background-color","");
		i = fens.length - 1;
		$("td#" + i).css("background-color","yellow");
		board.position(fens[i]);
		chart.series[0].points[i].select();
		$(".mytable").scrollTop($('td#0').offset().top);
		$(".mytable").scrollTop($('td#' + i).offset().top - 20);
	});
});
</script>



</body>

</html>
